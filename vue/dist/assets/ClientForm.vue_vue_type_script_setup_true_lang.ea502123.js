import{K as v,L as F,M as N,N as h,d as b,k as x,c as S,y as D,O as k,a as u,z as d,f,e as p,h as r,w as A,C as E,_ as M,F as V,G as B,H as L,g as P,B as T}from"./index.f2ff2e63.js";import{a as g}from"./axiosAuth.784738d2.js";import{u as I,_ as w,r as C,e as O}from"./Button.vue_vue_type_script_setup_true_lang.9c374701.js";const o=v(),U=F("ClientStore",{state:()=>({newClient:{form:{firstName:"",lastName:"",email:"",imageName:"",imageFile:null},loading:!1,isModalOpen:!1},pagination:{current_page:1,last_page:void 0,per_page:void 0},clients:[],loading:!1}),getters:{disableSubmit:e=>e.newClient.form.firstName===""||e.newClient.form.lastName===""||e.newClient.form.email===""||!e.newClient.form.imageFile},actions:{async _getPaginateClients(){this.$state.loading=!0;try{const e=await g.get(`/client?page=${this.$state.pagination.current_page}`),{data:t}=e;this.$state.clients=t.data;const{current_page:a,last_page:n,per_page:m}=t.meta;this.$state.pagination={current_page:a,last_page:n,per_page:m}}catch(e){console.log("Error fetching clients:",e)}finally{this.$state.loading=!1}},async _addClient(){this.$state.newClient.loading=!0;try{const e=this.createFormData(),t=await g.post("/client",e,{headers:{"Content-Type":"multipart/form-data"}});if(t.status===201&&(this._getPaginateClients(),this.$state.newClient.isModalOpen=!1,o.success("Client created successfully")),t.status===200){const a=N(t.data.errors);a&&o.error(a[0])}}catch(e){o.error(h(e))}finally{this.$state.newClient.loading=!1}},async _updateClient(e){this.$state.newClient.loading=!0;try{const t=this.createFormData(),a=await g.post(`/client/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}),{data:n}=a;if(n.errors){const m=N(n.errors);m&&o.error(m[0])}else o.success("Client updated successfully")}catch(t){o.error(h(t))}finally{this.$state.newClient.loading=!1}},async _deleteClient(e){try{(await g.delete(`/client/${e}`)).status===200&&(o.success("Client deleted successfully"),this._getPaginateClients())}catch(t){o.error(h(t))}},getClient(e){const t=this.$state.clients.find(a=>a.id===e);return t&&(this.$state.newClient.form={firstName:t.firstName,lastName:t.lastName,email:t.email,imageFile:t.avatar,imageName:t.avatar}),t},createFormData(){const e=new FormData;return e.append("firstName",this.$state.newClient.form.firstName),e.append("lastName",this.$state.newClient.form.lastName),e.append("email",this.$state.newClient.form.email),this.$state.newClient.form.imageFile&&typeof this.$state.newClient.form.imageFile=="object"&&e.append("avatar",this.$state.newClient.form.imageFile,this.$state.newClient.form.imageName),e},eraseForm(){this.$state.newClient.form={firstName:"",lastName:"",email:"",imageFile:null,imageName:""}}}}),j=["onSubmit"],R={class:""},q=f("div",{class:"font-semibold mb-2"},"Avatar Image",-1),z=["src"],J=b({__name:"ClientForm",emits:["submit"],setup(e,{emit:t}){const a=U(),n=x(),m=S(()=>({email:{required:C,email:O},firstName:{required:C},lastName:{required:C},imageFile:{required:C}})),c=I(m,a.newClient.form),_=i=>{const s=i.target.files[0];a.newClient.form.imageName=s.name,a.newClient.form.imageFile=s,$(s)},$=i=>{const s=new FileReader;s.onload=()=>{n.value=s.result},s.readAsDataURL(i)};D(()=>{const{imageFile:i}=a.newClient.form;(i==null?void 0:i.constructor)===File?$(i):n.value=i!=null?i:null});const y=()=>{c.value.$validate(),c.value.$error||t("submit")};return k(()=>{a.eraseForm()}),(i,s)=>(u(),d("form",{onSubmit:P(y,["prevent"])},[f("div",null,[p(w,{title:"First name",input:{value:r(a).newClient.form.firstName},errors:r(c).firstName.$errors,"title-color":"black",type:"text",class:"text-white",onChange:s[0]||(s[0]=l=>r(a).newClient.form.firstName=l)},null,8,["input","errors"])]),f("div",null,[p(w,{title:"Last name",input:{value:r(a).newClient.form.lastName},errors:r(c).lastName.$errors,"title-color":"black",type:"text",class:"text-white",onChange:s[1]||(s[1]=l=>r(a).newClient.form.lastName=l)},null,8,["input","errors"])]),f("div",null,[p(w,{title:"Email Address",input:{value:r(a).newClient.form.email},errors:r(c).email.$errors,"title-color":"black",type:"email",class:"text-white",onChange:s[2]||(s[2]=l=>r(a).newClient.form.email=l)},null,8,["input","errors"])]),f("div",R,[q,p(M,{justify:"start",gap:4},{default:A(()=>[n.value?(u(),d("img",{key:0,src:n.value,class:"w-20 h-20"},null,8,z)):E("",!0),f("input",{id:"imageFile",type:"file",class:"rounded-md border border-gray-300",onChange:_},null,32)]),_:1}),(u(!0),d(V,null,B(r(c).imageFile.$errors,l=>(u(),d("div",{key:l.$uid,class:"text-rose-700 text-base font-medium mt-1 px-2"},T(l.$message),1))),128))]),L(i.$slots,"default")],40,j))}});export{J as _,U as u};
